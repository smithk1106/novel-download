import{_ as A,r as f,k as F,d as G,e as R,c as r,a as s,l as c,w as a,v as d,n as b,F as h,h as U,t as u,i as M,g as E,m as v,o as i,p as H}from"./index-DxjiiVCz.js";import{g as _,A as C}from"./api-DMMksCow.js";const $={class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},z={class:"container mx-auto px-4 py-16"},J={class:"max-w-3xl mx-auto glass-card mb-8"},X={class:"space-y-6"},q={class:"settings-grid"},K={class:"form-group"},Q={class:"glass-input disabled"},W={class:"form-group relative",id:"source-multiselect"},Y={class:"mr-1"},Z=["onClick"],ss={key:1,class:"text-gray-400"},es=["onClick"],ts=["value"],ls={class:"form-group"},os={class:"glass-input"},as={class:"form-group"},ns={class:"glass-select"},rs={class:"form-group"},is={class:"glass-input"},ds={class:"form-group"},us={class:"glass-radio-group"},ps={class:"glass-radio"},vs={class:"glass-radio"},ms={class:"form-group"},gs={class:"glass-radio-group"},xs={class:"glass-radio"},bs={class:"glass-radio"},ys={class:"space-y-6"},fs={class:"settings-grid"},cs={class:"form-group"},ws={class:"glass-radio-group"},ks={class:"glass-radio"},Is={class:"glass-radio"},hs={class:"form-group"},Us={class:"glass-select"},_s={class:"form-group"},Cs={class:"glass-input"},Ss={class:"form-group"},Vs={class:"flex items-center space-x-2"},Ms={class:"glass-input flex-1"},Es={class:"glass-input flex-1"},Ts={class:"space-y-6"},Ls={class:"settings-grid"},Bs={class:"form-group"},Ds={class:"glass-input"},Ps={class:"form-group"},js={class:"flex items-center space-x-2"},Ns={class:"glass-input flex-1"},Os={class:"glass-input flex-1"},As={class:"space-y-6"},Fs={class:"settings-grid"},Gs={class:"form-group"},Rs={class:"glass-radio-group"},Hs={class:"glass-radio"},$s={class:"glass-radio"},zs={class:"form-group"},Js=["disabled"],Xs={class:"form-group"},qs=["disabled"],Ks={class:"form-actions"},Qs=["disabled"],Ws={key:0,class:"spinner",viewBox:"0 0 24 24"},Ys={key:1},Zs={class:"max-w-3xl mx-auto glass-card"},se={class:"overflow-x-auto bg-white bg-opacity-30 rounded-xl"},ee={class:"min-w-full"},te={class:"px-4 py-3 text-sm text-gray-700"},le={class:"px-4 py-3 text-sm text-gray-700"},oe={class:"px-4 py-3"},ae={class:"px-4 py-3"},ne={class:"px-4 py-3"},re={class:"px-4 py-3 text-sm text-gray-500 max-w-xs"},ie={key:0,class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},de={key:1,class:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ue={__name:"Setting",setup(pe){const l=f({}),m=f([]),y=f(!1),g=f({show:!1,type:"success",message:""}),n=f([]),w=f(!1),T=o=>o?o.split(",").map(e=>e.trim()).filter(Boolean):[],L=o=>o.filter(Boolean).join(","),x=(o,e="success")=>{g.value={show:!0,type:e,message:o},setTimeout(()=>{g.value.show=!1},3e3)},B=async()=>{try{y.value=!0;const e=await(await fetch(_(C.CONFIG.GET))).json();e.code===200?(l.value=e.data,n.value=T(l.value.manySourceId)):x(e.msg||"获取配置失败","error");const p=await(await fetch(_(C.CONFIG.GET_SOURCE_INFO))).json();p.code===200?m.value=p.data:x(p.msg||"获取数据源信息失败","error")}catch(o){console.error("获取配置失败:",o),x("获取配置失败，请检查网络连接","error")}finally{y.value=!1}},D=async()=>{try{if(!n.value.every(p=>m.value.some(O=>String(O.id)===String(p)))){x("存在无效的数据源ID","error");return}l.value.manySourceId=L(n.value),y.value=!0;const t=await(await fetch(_(C.CONFIG.UPDATE),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)})).json();t.code===200?x("保存成功"):x(t.msg||"保存失败","error")}catch(o){console.error("保存配置失败:",o),x("保存失败，请重试","error")}finally{y.value=!1}},P=o=>{n.value=n.value.filter(e=>e!==String(o))},j=o=>{o=String(o),n.value.includes(o)?n.value=n.value.filter(e=>e!==o):n.value.push(o)},S=F(()=>m.value.length>0&&n.value.length===m.value.length),N=()=>{S.value?n.value=[]:n.value=m.value.map(o=>String(o.id))},V=o=>{const e=document.getElementById("source-multiselect");e&&!e.contains(o.target)&&(w.value=!1)};G(()=>{B(),document.addEventListener("mousedown",V)}),R(()=>{document.removeEventListener("mousedown",V)});const k=o=>o===null?"inline-flex px-2 py-1 text-xs rounded-full bg-gray-100 bg-opacity-70 text-gray-800":o?"inline-flex px-2 py-1 text-xs rounded-full bg-green-100 bg-opacity-70 text-green-800":"inline-flex px-2 py-1 text-xs rounded-full bg-red-100 bg-opacity-70 text-red-800",I=o=>o===null?"未知":o?"支持":"不支持";return(o,e)=>(i(),r("div",$,[s("div",z,[e[65]||(e[65]=s("div",{class:"mb-12 text-center"},[s("h1",{class:"text-4xl font-bold text-gray-900"},"系统设置"),s("p",{class:"mt-2 text-gray-500"},"自定义您的下载和爬取参数")],-1)),s("div",J,[s("form",{onSubmit:c(D,["prevent"]),class:"space-y-8"},[s("div",X,[e[39]||(e[39]=s("h2",{class:"card-title"},"基础设置",-1)),s("div",q,[s("div",K,[e[25]||(e[25]=s("label",{class:"form-label"},"版本",-1)),s("div",Q,[a(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.version=t),type:"text",disabled:""},null,512),[[d,l.value.version]])])]),s("div",W,[e[27]||(e[27]=s("label",{class:"form-label"},"书源ID（多选）",-1)),s("div",{class:b(["flex flex-wrap items-center min-h-[20px] glass-input glass-multiselect px-2 py-1 cursor-pointer transition-all duration-200",{"ring-2 ring-blue-300":w.value}]),onClick:e[1]||(e[1]=t=>w.value=!w.value)},[n.value.length?(i(!0),r(h,{key:0},U(n.value,t=>(i(),r("span",{key:t,class:"glass-tag-read flex items-center mr-2 mb-2"},[s("span",Y,u(t),1),s("span",{class:"ml-1 cursor-pointer hover:text-gray-500 text-base font-bold",onClick:c(p=>P(t),["stop"]),title:"移除"},"×",8,Z)]))),128)):(i(),r("span",ss,"请选择书源ID")),e[26]||(e[26]=s("span",{class:"ml-auto text-gray-400"},[s("svg",{class:"w-4 h-4 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))],2),w.value?(i(),r("div",{key:0,class:"absolute z-20 mt-1 w-full glass-dropdown border rounded-xl shadow-2xl max-h-60 overflow-auto backdrop-blur-lg bg-white/60",onMousedown:e[4]||(e[4]=c(()=>{},["stop"]))},[s("div",{class:"px-3 py-2 hover:bg-blue-100/60 cursor-pointer font-bold text-blue-600 rounded-t-xl transition-all",onClick:c(N,["stop"])},u(S.value?"取消全选":"全选"),1),(i(!0),r(h,null,U(m.value,t=>(i(),r("div",{key:t.id,class:"px-3 py-2 hover:bg-blue-100/60 cursor-pointer flex items-center transition-all select-none",onClick:c(p=>j(t.id),["stop"])},[a(s("input",{type:"checkbox",class:"mr-2 accent-blue-500 rounded focus:ring-2 focus:ring-blue-300",value:String(t.id),"onUpdate:modelValue":e[2]||(e[2]=p=>n.value=p),onClick:e[3]||(e[3]=c(()=>{},["stop"]))},null,8,ts),[[H,n.value]]),s("span",null,u(t.id),1)],8,es))),128))],32)):M("",!0)]),s("div",ls,[e[28]||(e[28]=s("label",{class:"form-label"},"下载路径",-1)),s("div",os,[a(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.downloadPath=t),type:"text"},null,512),[[d,l.value.downloadPath]])])]),s("div",as,[e[30]||(e[30]=s("label",{class:"form-label"},"文件格式",-1)),s("div",ns,[a(s("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.extName=t)},e[29]||(e[29]=[s("option",{value:"epub"},"EPUB",-1),s("option",{value:"txt"},"TXT",-1)]),512),[[E,l.value.extName]])])]),s("div",rs,[e[31]||(e[31]=s("label",{class:"form-label"},"搜索结果限制",-1)),s("div",is,[a(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.searchLimit=t),type:"number",placeholder:"留空显示全部"},null,512),[[d,l.value.searchLimit]])]),e[32]||(e[32]=s("p",{class:"form-hint"},"每个书源显示的搜索结果数量",-1))]),s("div",ds,[e[35]||(e[35]=s("label",{class:"form-label"},"显示下载日志",-1)),s("div",us,[s("label",ps,[a(s("input",{type:"radio","onUpdate:modelValue":e[8]||(e[8]=t=>l.value.showDownloadLog=t),value:1},null,512),[[v,l.value.showDownloadLog]]),e[33]||(e[33]=s("span",{class:"radio-text"},"开启",-1))]),s("label",vs,[a(s("input",{type:"radio","onUpdate:modelValue":e[9]||(e[9]=t=>l.value.showDownloadLog=t),value:0},null,512),[[v,l.value.showDownloadLog]]),e[34]||(e[34]=s("span",{class:"radio-text"},"关闭",-1))])])]),s("div",ms,[e[38]||(e[38]=s("label",{class:"form-label"},"保留章节缓存",-1)),s("div",gs,[s("label",xs,[a(s("input",{type:"radio","onUpdate:modelValue":e[10]||(e[10]=t=>l.value.preserveChapterCache=t),value:1},null,512),[[v,l.value.preserveChapterCache]]),e[36]||(e[36]=s("span",{class:"radio-text"},"是",-1))]),s("label",bs,[a(s("input",{type:"radio","onUpdate:modelValue":e[11]||(e[11]=t=>l.value.preserveChapterCache=t),value:0},null,512),[[v,l.value.preserveChapterCache]]),e[37]||(e[37]=s("span",{class:"radio-text"},"否",-1))])])])])]),s("div",ys,[e[49]||(e[49]=s("h2",{class:"card-title"},"爬取设置",-1)),s("div",fs,[s("div",cs,[e[42]||(e[42]=s("label",{class:"form-label"},"自动更新",-1)),s("div",ws,[s("label",ks,[a(s("input",{type:"radio","onUpdate:modelValue":e[12]||(e[12]=t=>l.value.autoUpdate=t),value:1},null,512),[[v,l.value.autoUpdate]]),e[40]||(e[40]=s("span",{class:"radio-text"},"开启",-1))]),s("label",Is,[a(s("input",{type:"radio","onUpdate:modelValue":e[13]||(e[13]=t=>l.value.autoUpdate=t),value:0},null,512),[[v,l.value.autoUpdate]]),e[41]||(e[41]=s("span",{class:"radio-text"},"关闭",-1))])])]),s("div",hs,[e[44]||(e[44]=s("label",{class:"form-label"},"交互模式",-1)),s("div",Us,[a(s("select",{"onUpdate:modelValue":e[14]||(e[14]=t=>l.value.interactiveMode=t)},e[43]||(e[43]=[s("option",{value:1},"模式1",-1),s("option",{value:2},"模式2",-1)]),512),[[E,l.value.interactiveMode]])])]),s("div",_s,[e[45]||(e[45]=s("label",{class:"form-label"},"爬取线程数",-1)),s("div",Cs,[a(s("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>l.value.threads=t),type:"number"},null,512),[[d,l.value.threads]])]),e[46]||(e[46]=s("p",{class:"form-hint"},"-1表示自动设置",-1))]),s("div",Ss,[e[48]||(e[48]=s("label",{class:"form-label"},"爬取间隔 (毫秒)",-1)),s("div",Vs,[s("div",Ms,[a(s("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>l.value.minInterval=t),type:"number",placeholder:"最小"},null,512),[[d,l.value.minInterval]])]),e[47]||(e[47]=s("span",null,"-",-1)),s("div",Es,[a(s("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>l.value.maxInterval=t),type:"number",placeholder:"最大"},null,512),[[d,l.value.maxInterval]])])])])])]),s("div",Ts,[e[53]||(e[53]=s("h2",{class:"card-title"},"重试设置",-1)),s("div",Ls,[s("div",Bs,[e[50]||(e[50]=s("label",{class:"form-label"},"最大重试次数",-1)),s("div",Ds,[a(s("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>l.value.maxRetryAttempts=t),type:"number"},null,512),[[d,l.value.maxRetryAttempts]])])]),s("div",Ps,[e[52]||(e[52]=s("label",{class:"form-label"},"重试间隔 (毫秒)",-1)),s("div",js,[s("div",Ns,[a(s("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>l.value.retryMinInterval=t),type:"number",placeholder:"最小"},null,512),[[d,l.value.retryMinInterval]])]),e[51]||(e[51]=s("span",null,"-",-1)),s("div",Os,[a(s("input",{"onUpdate:modelValue":e[20]||(e[20]=t=>l.value.retryMaxInterval=t),type:"number",placeholder:"最大"},null,512),[[d,l.value.retryMaxInterval]])])])])])]),s("div",As,[e[59]||(e[59]=s("h2",{class:"card-title"},"代理设置",-1)),s("div",Fs,[s("div",Gs,[e[56]||(e[56]=s("label",{class:"form-label"},"HTTP代理",-1)),s("div",Rs,[s("label",Hs,[a(s("input",{type:"radio","onUpdate:modelValue":e[21]||(e[21]=t=>l.value.proxyEnabled=t),value:1},null,512),[[v,l.value.proxyEnabled]]),e[54]||(e[54]=s("span",{class:"radio-text"},"开启",-1))]),s("label",$s,[a(s("input",{type:"radio","onUpdate:modelValue":e[22]||(e[22]=t=>l.value.proxyEnabled=t),value:0},null,512),[[v,l.value.proxyEnabled]]),e[55]||(e[55]=s("span",{class:"radio-text"},"关闭",-1))])])]),s("div",zs,[e[57]||(e[57]=s("label",{class:"form-label"},"代理主机",-1)),s("div",{class:b(["glass-input",{disabled:!l.value.proxyEnabled}])},[a(s("input",{"onUpdate:modelValue":e[23]||(e[23]=t=>l.value.proxyHost=t),type:"text",disabled:!l.value.proxyEnabled},null,8,Js),[[d,l.value.proxyHost]])],2)]),s("div",Xs,[e[58]||(e[58]=s("label",{class:"form-label"},"代理端口",-1)),s("div",{class:b(["glass-input",{disabled:!l.value.proxyEnabled}])},[a(s("input",{"onUpdate:modelValue":e[24]||(e[24]=t=>l.value.proxyPort=t),type:"number",disabled:!l.value.proxyEnabled},null,8,qs),[[d,l.value.proxyPort]])],2)])])]),s("div",Ks,[s("button",{type:"submit",class:"glass-button primary",disabled:y.value},[y.value?(i(),r("svg",Ws,e[60]||(e[60]=[s("circle",{class:"spinner-path",cx:"12",cy:"12",r:"10"},null,-1)]))):(i(),r("span",Ys,"保存设置"))],8,Qs)])],32)]),s("div",Zs,[e[62]||(e[62]=s("h2",{class:"card-title"},"数据源信息",-1)),s("div",se,[s("table",ee,[e[61]||(e[61]=s("thead",null,[s("tr",null,[s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200"}," 书源 ID "),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200"}," 书源名称 "),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200"}," 大陆 IP "),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200"}," 非大陆 IP "),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200"}," 支持搜索 "),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider border-b border-gray-200"}," 需要注意 ")])],-1)),s("tbody",null,[(i(!0),r(h,null,U(m.value,t=>(i(),r("tr",{key:t.id,class:"hover:bg-white hover:bg-opacity-20 transition-colors"},[s("td",te,u(t.id),1),s("td",le,u(t.name),1),s("td",oe,[s("span",{class:b(k(t.mainlandIp))},u(I(t.mainlandIp)),3)]),s("td",ae,[s("span",{class:b(k(t.nonMainlandIp))},u(I(t.nonMainlandIp)),3)]),s("td",ne,[s("span",{class:b(k(t.supportSearch))},u(I(t.supportSearch)),3)]),s("td",re,u(t.note||"-"),1)]))),128))])])])]),g.value.show?(i(),r("div",{key:0,class:b(["fixed bottom-4 right-4 glass-toast flex items-center p-4 space-x-4 text-sm rounded-2xl shadow-lg transition-all duration-300",{"bg-green-50 bg-opacity-80 text-green-800":g.value.type==="success","bg-red-50 bg-opacity-80 text-red-800":g.value.type==="error"}])},[g.value.type==="success"?(i(),r("svg",ie,e[63]||(e[63]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):(i(),r("svg",de,e[64]||(e[64]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)]))),s("p",null,u(g.value.message),1)],2)):M("",!0)])]))}},ge=A(ue,[["__scopeId","data-v-e62800d1"]]);export{ge as default};
