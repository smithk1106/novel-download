import{_ as J,r as a,d as R,e as W,c as s,a as e,w as x,v as y,f as $,g as K,F as k,h as z,t as d,i as B,o as n,n as C,j as G}from"./index-DxjiiVCz.js";import{W as P}from"./api-DMMksCow.js";const Q={class:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100"},q={class:"container mx-auto px-4 py-16"},X={class:"max-w-3xl mx-auto mb-12"},Y={class:"relative group"},Z={class:"relative p-6 sm:p-8"},ee={class:"flex flex-col sm:flex-row gap-4"},te={class:"flex-1 flex flex-col sm:flex-row gap-4"},oe={class:"relative flex-1"},le=["disabled"],se={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},ne={key:1,class:"animate-spin h-6 w-6",viewBox:"0 0 24 24"},ae={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},re={class:"relative"},ie={class:"relative p-8"},de={key:0,class:"bg-white/80 backdrop-blur-md rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow duration-300 border border-white/50"},ue={class:"flex items-start gap-4"},ce={class:"flex-1"},pe={class:"flex items-center gap-2 mb-1"},ve={class:"text-lg font-semibold text-slate-800"},be={class:"flex items-center text-sm text-slate-500 mb-2"},he={class:"mt-2 flex items-center gap-4 text-sm"},we={class:"flex items-center text-slate-500"},xe=["href"],fe=["onClick"],me={class:"flex justify-between items-center text-sm text-slate-500"},ge={class:"relative"},ye={class:"relative p-8"},ke={class:"space-y-3"},Ce={class:"flex items-start gap-3 p-3 bg-white/80 backdrop-blur-md rounded-lg shadow-sm"},_e={class:"flex-1"},Ne={class:"text-sm text-slate-700"},Me={class:"mt-4 p-4 bg-white/30 backdrop-blur-lg rounded-xl"},Se={class:"flex justify-between items-center text-sm text-slate-500"},De={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Te={class:"relative w-full max-w-md mx-4 bg-gradient-to-br from-white/20 to-white/10 backdrop-blur-xl border border-white/30 rounded-2xl shadow-2xl overflow-hidden"},ze={class:"relative p-6 z-10"},Be={class:"flex border-b border-white/30 mb-6"},Ie=["onClick"],je={key:0,class:"space-y-4"},Ve={class:"text-slate-700"},Le={key:1,class:"space-y-4"},Fe={class:"flex space-x-4"},Ue={class:"w-1/2"},Ae={class:"w-1/2"},Ee={key:2,class:"space-y-4"},Oe=5,He=1e3,Je={__name:"Crawler",setup(Re){const f=a(""),_=a("fuzzy"),u=a(!1),w=a([]),N=a(0),M=a("未连接"),m=a(null),g=a(null),b=a(0);let r=null,h=null;const L=l=>{try{const t=JSON.parse(l),o=JSON.parse(t.content);return{id:t.id,sourceId:t.sourceId,isStop:t.isStop,title:o.bookName,author:o.author.replace("作者：",""),latestChapter:o.latestChapter,url:o.url}}catch(t){return console.error("解析小说信息失败:",t),null}},I=()=>{(r==null?void 0:r.readyState)!==WebSocket.CONNECTING&&(r=new WebSocket(P),r.onopen=()=>{M.value="已连接",b.value=0,h&&(clearTimeout(h),h=null),c({type:"console",content:"连接成功，请输入小说名称开始搜索"})},r.onmessage=l=>{const t=JSON.parse(l.data);if(t.type==="NovelNameSearchResultMessageListener"){const o=L(t.content);o&&(N.value++,c({type:"novel",content:o,isNew:!0}),o.isStop&&(u.value=!1,c({type:"console",content:"搜索完成",isNew:!0})))}else if(t.type==="NovelNameSearchConsoleMessageListener"){const o=t.content;c({type:"console",content:o,isNew:!0}),(o.includes("错误")||o.includes("搜索完成"))&&(u.value=!1)}else t.type==="NovelDownloadConsoleMessageListener"&&(c({type:"download",content:t.content,isNew:!0}),U());F()},r.onclose=()=>{if(M.value="连接已断开",u.value=!1,b.value<Oe){const l=Math.min(He*Math.pow(2,b.value),3e4);b.value++,c({type:"console",content:`连接已断开，${b.value}秒后尝试第${b.value}次重连...`}),h=setTimeout(()=>{I()},l)}else c({type:"console",content:"重连次数已达上限，请刷新页面重试"})},r.onerror=()=>{u.value=!1})},c=l=>{w.value.push(l),l.isNew&&setTimeout(()=>{l.isNew=!1},5e3)},F=()=>{m.value&&(m.value.scrollTop=m.value.scrollHeight)},U=()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)},j=()=>{f.value.trim()&&(u.value=!0,w.value=[],N.value=0,r.send(JSON.stringify({type:"NovelNameSearchMessageListener",content:{bookName:f.value,searchType:_.value}})))};R(()=>{I()}),W(()=>{h&&clearTimeout(h),r&&r.close()});const S=a(!1),D=a({}),p=a(0),V=[{label:"全本下载",type:0},{label:"指定章节",type:1},{label:"最新章节",type:2}],i=a({startChapter:1,endChapter:100,latestChapterCount:10}),A=l=>{D.value=l,S.value=!0,p.value=0,i.value={startChapter:1,endChapter:100,latestChapterCount:10}},T=()=>{S.value=!1},E=l=>{p.value=l},O=()=>{const l=V[p.value].type,t={searchResultId:D.value.id,downloadType:l};l===1?(t.startChapter=parseInt(i.value.startChapter)||1,t.endChapter=parseInt(i.value.endChapter)||100):l===2&&(t.latestChapterCount=parseInt(i.value.latestChapterCount)||10),r.send(JSON.stringify({type:"NovelDownloadMessageListener",content:t})),T()};return(l,t)=>(n(),s(k,null,[e("div",Q,[e("div",q,[e("div",X,[e("div",Y,[t[8]||(t[8]=e("div",{class:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-3xl border border-white/30 shadow-2xl"},null,-1)),e("div",Z,[e("div",ee,[e("div",te,[e("div",oe,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>f.value=o),type:"text",placeholder:"输入小说名称或作者",onKeyup:$(j,["enter"]),class:"w-full pl-6 pr-14 py-4 bg-white/10 backdrop-blur-sm border-0 rounded-2xl text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/20 transition-all duration-300"},null,544),[[y,f.value]]),e("button",{onClick:j,class:"absolute right-3 top-1/2 -translate-y-1/2 p-2 text-slate-400 hover:text-blue-500 transition-all duration-300 rounded-xl hover:bg-white/20",disabled:u.value},[u.value?(n(),s("svg",ne,t[6]||(t[6]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(n(),s("svg",se,t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])))],8,le)]),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),class:"w-full sm:w-auto px-6 py-4 bg-white/10 backdrop-blur-sm border-0 rounded-2xl text-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/20 transition-all duration-300 appearance-none cursor-pointer pr-12",style:{"background-image":"url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22%23666%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E')","background-repeat":"no-repeat","background-position":"right 12px center","background-size":"16px"}},t[7]||(t[7]=[e("option",{value:"fuzzy"},"模糊搜索",-1),e("option",{value:"exact"},"精确搜索",-1)]),512),[[K,_.value]])])])])])]),e("div",ae,[e("div",re,[t[14]||(t[14]=e("div",{class:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-3xl border border-white/30 shadow-2xl"},null,-1)),e("div",ie,[t[13]||(t[13]=e("h2",{class:"text-2xl font-semibold text-slate-800 mb-6"},"搜索结果",-1)),e("div",{ref_key:"messageContainer",ref:m,class:"bg-white/30 backdrop-blur-lg rounded-xl p-4 h-96 overflow-y-auto space-y-4 mb-6"},[(n(!0),s(k,null,z(w.value,(o,v)=>(n(),s("div",{key:v,class:C(["message-item",{"fade-in":o.isNew}])},[o.type==="novel"?(n(),s("div",de,[e("div",ue,[e("div",ce,[e("div",pe,[t[9]||(t[9]=e("svg",{class:"w-5 h-5 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})],-1)),e("h3",ve,d(o.content.title),1)]),e("div",be,[t[10]||(t[10]=e("svg",{class:"w-4 h-4 mr-1 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("span",null,d(o.content.author),1)]),e("div",he,[e("div",we,[t[11]||(t[11]=e("svg",{class:"w-4 h-4 mr-1 text-emerald-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e("span",null,"最新章节："+d(o.content.latestChapter),1)]),e("a",{href:o.content.url,target:"_blank",class:"flex items-center text-blue-400 hover:text-blue-500 transition-colors"},t[12]||(t[12]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1),G(" 查看源网站 ")]),8,xe)])]),e("button",{onClick:H=>A(o.content),class:"bg-gradient-to-r from-blue-300 to-cyan-400 text-white px-4 py-2 rounded-lg font-medium hover:from-blue-400 hover:to-cyan-500 transition-all duration-300 flex items-center gap-1 shadow-sm shadow-blue-500/20"}," 抓取 ",8,fe)])])):o.type==="console"?(n(),s("div",{key:1,class:C(["text-sm py-2 px-3 rounded-lg font-medium",{"bg-blue-100/80 text-blue-700":o.content.includes("成功"),"bg-yellow-100/80 text-yellow-700":o.content.includes("搜索")||o.content.includes("数据源"),"bg-red-100/80 text-red-700":o.content.includes("错误")||o.content.includes("失败"),"bg-slate-100/80 text-slate-700":!o.content.includes("成功")&&!o.content.includes("搜索")&&!o.content.includes("错误")&&!o.content.includes("失败")}])},d(o.content),3)):B("",!0)],2))),128))],512),e("div",me,[e("span",null,"已找到 "+d(N.value)+" 本小说",1),e("span",null,d(M.value),1)])])]),e("div",ge,[t[17]||(t[17]=e("div",{class:"absolute inset-0 bg-white/20 backdrop-blur-xl rounded-3xl border border-white/30 shadow-2xl"},null,-1)),e("div",ye,[t[16]||(t[16]=e("h2",{class:"text-2xl font-semibold text-slate-800 mb-6"},"下载进度",-1)),e("div",{ref_key:"downloadContainer",ref:g,class:"bg-white/30 backdrop-blur-lg rounded-xl p-4 h-96 overflow-y-auto"},[e("div",ke,[(n(!0),s(k,null,z(w.value.filter(o=>o.type==="download"),(o,v)=>(n(),s("div",{key:v,class:C(["download-message",{"fade-in":o.isNew}])},[e("div",Ce,[t[15]||(t[15]=e("div",{class:"text-blue-500 flex-shrink-0 mt-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4 4m0 0l-4-4m4 4V4"})])],-1)),e("div",_e,[e("p",Ne,d(o.content),1)])])],2))),128))])],512),e("div",Me,[e("div",Se,[e("span",null,"下载消息数: "+d(w.value.filter(o=>o.type==="download").length),1)])])])])])])]),S.value?(n(),s("div",De,[e("div",{class:"absolute inset-0 bg-slate-900/50 backdrop-blur-sm",onClick:T}),e("div",Te,[e("div",ze,[t[21]||(t[21]=e("div",{class:"absolute -top-24 -left-24 w-48 h-48 bg-cyan-400/20 rounded-full blur-3xl"},null,-1)),t[22]||(t[22]=e("div",{class:"absolute -bottom-20 -right-20 w-56 h-56 bg-blue-500/20 rounded-full blur-3xl"},null,-1)),t[23]||(t[23]=e("h3",{class:"text-xl font-semibold text-slate-800 mb-4"},"下载设置",-1)),e("div",Be,[(n(),s(k,null,z(V,(o,v)=>e("button",{key:v,onClick:H=>E(v),class:C(["px-4 py-2 font-medium text-sm transition-all duration-300",p.value===v?"border-b-2 border-blue-500 text-blue-600":"text-slate-600 hover:text-blue-500"])},d(o.label),11,Ie)),64))]),p.value===0?(n(),s("div",je,[e("p",Ve,"将下载《"+d(D.value.title)+"》的全部章节",1)])):p.value===1?(n(),s("div",Le,[e("div",Fe,[e("div",Ue,[t[18]||(t[18]=e("label",{class:"block text-sm text-slate-600 mb-1"},"开始章节",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>i.value.startChapter=o),type:"number",min:"1",class:"w-full px-4 py-2 bg-white/30 backdrop-blur-sm rounded-lg border border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/40 transition-all",placeholder:"开始章节"},null,512),[[y,i.value.startChapter]])]),e("div",Ae,[t[19]||(t[19]=e("label",{class:"block text-sm text-slate-600 mb-1"},"结束章节",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>i.value.endChapter=o),type:"number",min:"1",class:"w-full px-4 py-2 bg-white/30 backdrop-blur-sm rounded-lg border border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/40 transition-all",placeholder:"结束章节"},null,512),[[y,i.value.endChapter]])])])])):p.value===2?(n(),s("div",Ee,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm text-slate-600 mb-1"},"下载最新章节数量",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>i.value.latestChapterCount=o),type:"number",min:"1",class:"w-full px-4 py-2 bg-white/30 backdrop-blur-sm rounded-lg border border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400/50 focus:bg-white/40 transition-all",placeholder:"例如: 10"},null,512),[[y,i.value.latestChapterCount]])])])):B("",!0),e("div",{class:"flex justify-end space-x-3 mt-6"},[e("button",{onClick:T,class:"px-4 py-2 rounded-lg bg-white/30 backdrop-blur-sm text-slate-700 hover:bg-white/40 transition-all duration-300 border border-white/20"}," 取消 "),e("button",{onClick:O,class:"px-4 py-2 rounded-lg bg-gradient-to-r from-blue-400 to-cyan-500 text-white hover:from-blue-500 hover:to-cyan-600 transition-all duration-300 shadow-lg shadow-blue-500/20 z-20 relative"}," 开始下载 ")])])])])):B("",!0)],64))}},Ke=J(Je,[["__scopeId","data-v-459e56ad"]]);export{Ke as default};
